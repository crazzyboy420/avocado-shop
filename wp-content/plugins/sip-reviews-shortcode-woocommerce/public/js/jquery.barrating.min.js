(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof module==='object'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}(function($){var BarRating=(function(){function BarRating(){var self=this;var wrapElement=function(){var classes=[self.options.wrapperClass];if(self.options.theme!==''){classes.push('br-theme-'+self.options.theme);}
self.$elem.wrap($('<div />',{'class':classes.join(' ')}));};var unwrapElement=function(){self.$elem.unwrap();};var findInitialOption=function(){var option;if(self.options.initialRating){option=$('option[value="'+self.options.initialRating+'"]',self.$elem);}else{option=$('option:selected',self.$elem);}
return option;};var saveDataOnElement=function(){var $opt=findInitialOption();self.$elem.data('barrating',{userOptions:self.options,currentRatingValue:$opt.val(),currentRatingText:($opt.data('html'))?$opt.data('html'):$opt.text(),originalRatingValue:$opt.val(),originalRatingText:($opt.data('html'))?$opt.data('html'):$opt.text()});self.$elem.data('barrating').deselectable=(!self.$elem.find('option:first').val())?true:false;};var removeDataOnElement=function(){self.$elem.removeData('barrating');};var buildWidget=function(){var $w=$('<div />',{'class':'br-widget'});self.$elem.find('option').each(function(){var val,text,html,$a,$span;val=$(this).val();if(val){text=$(this).text();html=$(this).data('html');if(html){text=html;}
$a=$('<a />',{'href':'#','data-rating-value':val,'data-rating-text':text});$span=$('<span />',{'html':(self.options.showValues)?text:''});$w.append($a.append($span));}});if(self.options.showSelectedRating){$w.append($('<div />',{'text':'','class':'br-current-rating'}));}
if(self.options.reverse){$w.addClass('br-reverse');}
if(self.options.readonly){$w.addClass('br-readonly');}
return $w;};var nextAllorPreviousAll=function(){if(self.options.reverse){return'nextAll';}else{return'prevAll';}};var setSelectFieldValue=function(value){self.$elem.find('option[value="'+value+'"]').prop('selected',true);self.$elem.change();};var showSelectedRating=function(text){text=text?text:self.$elem.data('barrating').currentRatingText;if(self.options.showSelectedRating){self.$elem.parent().find('.br-current-rating').text(text);}};var applyStyle=function($w){$w.find('a').removeClass('br-selected br-current');$w.find('a[data-rating-value="'+self.$elem.data('barrating').currentRatingValue+'"]').addClass('br-selected br-current')[nextAllorPreviousAll()]().addClass('br-selected');};var attachClickHandler=function($all){$all.on('click',function(event){var $a=$(this),value,text;event.preventDefault();$all.removeClass('br-active br-selected');$a.addClass('br-selected')[nextAllorPreviousAll()]().addClass('br-selected');value=$a.attr('data-rating-value');text=$a.attr('data-rating-text');if($a.hasClass('br-current')&&self.$elem.data('barrating').deselectable){$a.removeClass('br-selected br-current')[nextAllorPreviousAll()]().removeClass('br-selected br-current');value='';text='';}else{$all.removeClass('br-current');$a.addClass('br-current');}
self.$elem.data('barrating').currentRatingValue=value;self.$elem.data('barrating').currentRatingText=text;setSelectFieldValue(value);showSelectedRating(text);self.options.onSelect.call(this,self.$elem.data('barrating').currentRatingValue,self.$elem.data('barrating').currentRatingText);return false;});};var attachMouseEnterHandler=function($all){$all.on({mouseenter:function(){var $a=$(this);$all.removeClass('br-active br-selected');$a.addClass('br-active')[nextAllorPreviousAll()]().addClass('br-active');showSelectedRating($a.attr('data-rating-text'));}});};var attachMouseLeaveHandler=function($all,$widget){$widget.on({mouseleave:function(){$all.removeClass('br-active');showSelectedRating();applyStyle($widget);}});};var fastClicks=function($all){$all.on('touchstart',function(event){event.preventDefault();event.stopPropagation();$(this).click();});};var disableClicks=function($all){$all.on('click',function(event){event.preventDefault();});};this.show=function(){var $widget,$all;if(self.$elem.data('barrating'))return;wrapElement();saveDataOnElement();$widget=buildWidget();$widget.insertAfter(self.$elem);applyStyle($widget);showSelectedRating();$all=$widget.find('a');if(self.options.fastClicks){fastClicks($all);}
if(self.options.readonly){disableClicks($all);}else{attachClickHandler($all);if(self.options.hoverState){attachMouseEnterHandler($all);attachMouseLeaveHandler($all,$widget);}}
self.$elem.hide();};this.set=function(value){if(!this.$elem.find('option[value="'+value+'"]').val())return;this.$elem.data('barrating').currentRatingValue=value;this.$elem.data('barrating').currentRatingText=this.$elem.find('option[value="'+value+'"]').text();setSelectFieldValue(this.$elem.data('barrating').currentRatingValue);showSelectedRating(this.$elem.data('barrating').currentRatingText);applyStyle(this.$widget);this.$elem.data('barrating').userOptions.onSelect.call(this,this.$elem.data('barrating').currentRatingValue,this.$elem.data('barrating').currentRatingText);};this.clear=function(){this.$elem.data('barrating').currentRatingValue=this.$elem.data('barrating').originalRatingValue;this.$elem.data('barrating').currentRatingText=this.$elem.data('barrating').originalRatingText;setSelectFieldValue(this.$elem.data('barrating').currentRatingValue);showSelectedRating(this.$elem.data('barrating').currentRatingText);applyStyle(this.$widget);this.$elem.data('barrating').userOptions.onClear.call(this,this.$elem.data('barrating').currentRatingValue,this.$elem.data('barrating').currentRatingText);};this.destroy=function(){var value=this.$elem.data('barrating').currentRatingValue;var text=this.$elem.data('barrating').currentRatingText;var options=this.$elem.data('barrating').userOptions;this.$widget.off().remove();removeDataOnElement();unwrapElement();this.$elem.show();options.onDestroy.call(this,value,text);};}
BarRating.prototype.init=function(options,elem){this.$elem=$(elem);this.options=$.extend({},$.fn.barrating.defaults,options);return this.options;};return BarRating;})();$.fn.barrating=function(method,options){return this.each(function(){var plugin=new BarRating();if(!$(this).is('select')){$.error('Sorry, this plugin only works with select fields.');}
if(plugin.hasOwnProperty(method)){plugin.init(options,this);if(method==='show'){return plugin.show(options);}else{if(plugin.$elem.data('barrating')){plugin.$widget=$(this).next('.br-widget');return plugin[method](options);}}}else if(typeof method==='object'||!method){options=method;plugin.init(options,this);return plugin.show();}else{$.error('Method '+method+' does not exist on jQuery.barrating');}});};$.fn.barrating.defaults={theme:'',initialRating:null,showValues:false,showSelectedRating:true,reverse:false,readonly:false,fastClicks:true,hoverState:true,wrapperClass:'br-wrapper',onSelect:function(value,text){},onClear:function(value,text){},onDestroy:function(value,text){}};$.fn.barrating.BarRating=BarRating;}));